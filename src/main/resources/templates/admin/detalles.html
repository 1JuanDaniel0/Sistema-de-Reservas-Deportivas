<!DOCTYPE html>
<html lang="es" class="light-style layout-navbar-fixed layout-menu-fixed layout-compact" dir="ltr" data-theme="theme-semi-dark" data-assets-path="/" data-template="vertical-menu-template-semi-dark" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="'Detalles del Espacio: ' + ${espacio.nombre} + ' - Municipalidad de San Miguel'">Detalles del Espacio Deportivo</title>
    <meta name="description" th:content="'Conoce los detalles del espacio deportivo ' + ${espacio.nombre} + ' en ' + ${espacio.idLugar.lugar} + '. Reserva ahora en la Municipalidad de San Miguel.'" />
    <meta name="keywords" content="detalles, espacio deportivo, canchas, san miguel, municipalidad">
    <!-- Canonical SEO -->
    <link rel="canonical" href="https://themeselection.com/item/sneat-dashboard-pro-bootstrap/">
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" th:href="@{/img/icono.ico}">
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&amp;display=swap" rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" th:href="@{/vendor/fonts/boxicons.css}" />
    <link rel="stylesheet" th:href="@{/vendor/fonts/fontawesome.css}" />
    <link rel="stylesheet" th:href="@{/vendor/fonts/flag-icons.css}" />
    <!-- Core CSS -->
    <link rel="stylesheet" th:href="@{/vendor/css/rtl/core.css}" class="template-customizer-core-css" />
    <link rel="stylesheet" th:href="@{/vendor/css/rtl/theme-semi-dark.css}" class="template-customizer-theme-css" />
    <link rel="stylesheet" th:href="@{/css/demo.css}" />
    <!-- Vendors CSS -->
    <link rel="stylesheet" th:href="@{/vendor/libs/perfect-scrollbar/perfect-scrollbar.css}" />
    <link rel="stylesheet" th:href="@{/vendor/libs/swiper/swiper.css}" />
    <link rel="stylesheet" th:href="@{/vendor/libs/typeahead-js/typeahead.css}" />
    <!-- Page CSS -->
    <link rel="stylesheet" th:href="@{/vendor/css/pages/app-academy-details.css}" />
    <link rel="stylesheet" th:href="@{/vendor/css/pages/ui-carousel.css}" />
    <link rel="stylesheet" th:href="@{/vendor/libs/rateyo/rateyo.css}" />

    <!-- Helpers -->
    <script th:src="@{/vendor/js/helpers.js}"></script>
    <script th:src="@{/js/config.js}"></script>
</head>
<body>
<!-- Layout wrapper -->
<div class="layout-wrapper layout-content-navbar">
    <div class="layout-container">
        <div th:replace="~{fragments/sidebar-admin :: sidebarAdmin('espacios', 'espacios-deportivos')}"></div>
        <!-- Layout container -->
        <div class="layout-page">
            <div th:replace="~{fragments/navbar-admin :: navbarAdmin}"></div>
            <!-- Content wrapper -->
            <div class="content-wrapper">
                <!-- Content -->
                <div class="container-xxl flex-grow-1 container-p-y">
                    <div class="card g-3">
                        <div class="card-body row g-3">
                            <div class="col-lg-8">
                                <div class="d-flex justify-content-between align-items-center flex-wrap mb-2 gap-1">
                                    <!-- Bloque izquierdo: botón + nombre -->
                                    <div class="d-flex align-items-center gap-4 me-1">
                                        <button type="button" class="btn btn-secondary btn-sm" onclick="volver()">
                                            <i class="bx bx-arrow-back"></i> Regresar
                                        </button>
                                        <h3 class="fw-bold mb-0" th:text="${espacio.nombre}">Nombre del Espacio</h3>
                                    </div>
                                    <div class="d-flex align-items-center">
                                        <span class="badge bg-label-hover-primary" th:text="${espacio.tipoEspacio.nombre}">Tipo de Espacio</span>
                                    </div>
                                </div>
                                <div class="card academy-content shadow-none border">
                                    <div class="p-2">
                                        <div class="cursor-pointer">
                                            <th:block th:with="imagenDefecto='https://almacenamiento-aplicacion-archivos.s3.us-east-1.amazonaws.com/publica/estaticos/EspacioRepresentacion.webp'">
                                                <div class="swiper" id="swiper-3d-coverflow-effect">
                                                    <div class="swiper-wrapper w-100">
                                                        <!-- Slide 1: foto2 -->
                                                        <div class="swiper-slide"
                                                             th:style="'background-image:url(' + (${espacio.foto2Url} != null ? ${espacio.foto2Url} : ${imagenDefecto}) + ')'">
                                                        </div>
                                                        <!-- Slide 2: foto1 -->
                                                        <div class="swiper-slide"
                                                             th:style="'background-image:url(' + (${espacio.foto1Url} != null ? ${espacio.foto1Url} : ${imagenDefecto}) + ')'">
                                                        </div>
                                                        <!-- Slide 3: foto3 -->
                                                        <div class="swiper-slide"
                                                             th:style="'background-image:url(' + (${espacio.foto3Url} != null ? ${espacio.foto3Url} : ${imagenDefecto}) + ')'">
                                                        </div>
                                                    </div>
                                                    <div class="swiper-pagination"></div>
                                                </div>
                                            </th:block>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <!-- Esta calificación la pondré en la derecha
                                        <h5>Calificación Promedio</h5>
                                        <div class="rateyo-readonly mx-auto"
                                             th:data-rating="${calificacionesMap[espacio.idEspacio] != null ? calificacionesMap[espacio.idEspacio] : 0}">
                                        </div>
                                        <hr class="my-4">
                                        -->
                                        <h5>Descripción</h5>
                                        <p class="mb-4" th:text="${espacio.descripcion}">
                                            The material of this course is also covered in my other course about web design and development
                                            with HTML5 & CSS3. Scroll to the bottom of this page to check out that course, too!
                                            If you're already taking my other course, you already have all it takes to start designing beautiful
                                            websites today!
                                        </p>
                                        <hr class="my-4">
                                        <h5>Ubicación</h5>
                                        <div class="d-flex flex-wrap">
                                            <iframe th:src="'https://www.google.com/maps?q=' + ${espacio.idLugar.ubicacion} + '&output=embed'" width="100%" height="300" allowfullscreen loading="lazy"></iframe>
                                        </div>
                                        <hr class="mb-4 mt-2">
                                        <h5>Coordinadores Encargados</h5>
                                        <div th:if="${#lists.isEmpty(coordinadores)}">
                                            <p class="text-muted">No hay coordinadores asignados a este lugar.</p>
                                        </div>

                                        <div th:each="c : ${coordinadores}" class="d-flex justify-content-start align-items-center mb-2">
                                            <div class="avatar-wrapper">
                                                <div class="avatar avatar-sm me-2">
                                                    <div class="avatar avatar-sm me-2">
                                                        <!-- Si tiene foto -->
                                                        <img th:if="${c.fotoPerfil != null}"
                                                             th:src="${c.fotoPerfil}"
                                                             class="rounded-circle" alt="Avatar"
                                                             style="width: 40px; height: 40px; object-fit: cover;" />

                                                        <!-- Si no tiene foto, mostrar iniciales -->
                                                        <span th:unless="${c.fotoPerfil != null}"
                                                              class="avatar-initial rounded-circle bg-label-warning"
                                                              th:text="${#strings.substring(c?.nombres, 0, 1).toUpperCase() + #strings.substring(c?.apellidos, 0, 1).toUpperCase()}">
                                                            NA
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="d-flex flex-column">
                                                <span class="fw-medium" th:text="${c.nombres + ' ' + c.apellidos}">Nombre completo</span>
                                                <small class="text-muted">Coordinador del lugar</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="accordion stick-top accordion-bordered" id="courseContent">
                                    <div class="accordion-item shadow-none border border-bottom mb-0 active">
                                        <div class="accordion-header" id="headingOne">
                                            <button type="button" class="accordion-button bg-lighter rounded-0" data-bs-toggle="collapse" data-bs-target="#chapterOne" aria-expanded="true" aria-controls="chapterOne">
                                                <span class="d-flex flex-column">
                                                    <span class="h5 mb-1">Resumen del Espacio</span>
                                                </span>
                                            </button>
                                        </div>
                                        <div id="chapterOne" class="accordion-collapse collapse show" data-bs-parent="#courseContent">
                                            <div class="accordion-body py-3 border-top">
                                                <!-- Lugar -->
                                                <p class="mb-3">
                                                    <i class="bx bx-building-house bx-sm me-2"></i>
                                                    <strong>Lugar:</strong> <span th:text="${espacio.idLugar.lugar}">Lugar</span>
                                                </p>
                                                <!-- Direccion -->
                                                <p class="mb-3">
                                                    <i class="bx bx-location-plus bx-sm me-2"></i>
                                                    <strong>Dirección:</strong> <span th:text="${espacio.idLugar.direccion}">Lugar</span>
                                                </p>
                                                <!-- Tipo de espacio -->
                                                <p class="mb-3">
                                                    <i class='bx bx-category bx-sm me-2'></i>
                                                    <strong>Tipo:</strong> <span th:text="${espacio.tipoEspacio.nombre}">Cancha</span>
                                                </p>
                                                <!-- Deportes disponibles -->
                                                <p class="mb-3">
                                                    <i class='bx bx-football bx-sm me-2'></i>
                                                    <strong>Deportes:</strong>
                                                    <span th:each="deporte, iterStat : ${espacio.deportes}">
                                                        <span th:text="${deporte.nombre} + ${iterStat.last ? '' : ', '}" />
                                                    </span>
                                                </p>
                                                <!-- Precio por hora -->
                                                <p class="mb-3">
                                                    <i class='bx bx-money bx-sm me-2'></i>
                                                    <strong>Precio/hora:</strong>
                                                    <span th:text="'S/' + ${espacio.costo}">30.00</span> soles
                                                </p>
                                                <!-- Estado del espacio -->
                                                <p class="mb-3">
                                                    <i class='bx bx-check-circle bx-sm me-2'></i>
                                                    <strong>Estado:</strong> <span th:text="${espacio.idEstadoEspacio.estado}">Disponible</span>
                                                </p>
                                                <!-- Calificación promedio con estrellas -->
                                                <p class="mb-3 d-flex align-items-center">
                                                    <i class='bx bxs-star bx-sm me-2 text-warning'></i>
                                                    <strong class="me-2">Calificación:</strong>
                                                    <span class="me-2 rateyo-readonly" th:data-rating="${promedioCalificacion}"></span>
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="accordion-item shadow-none border border-bottom mb-0">
                                        <div class="accordion-header" id="headingObservaciones">
                                            <button type="button" class="accordion-button bg-lighter collapsed rounded-0" data-bs-toggle="collapse" data-bs-target="#chapterObservaciones" aria-expanded="false" aria-controls="chapterObservaciones">
                                              <span class="d-flex flex-column">
                                                <span class="h5 mb-1">Observaciones</span>
                                              </span>
                                            </button>
                                        </div>
                                        <div id="chapterObservaciones" class="accordion-collapse collapse show" data-bs-parent="#courseContent">
                                            <div class="accordion-body py-3 border-top">
                                                <div th:if="${#lists.isEmpty(observaciones)}">
                                                    <p class="text-muted">No hay observaciones registradas para este espacio.</p>
                                                </div>

                                                <ul class="timeline ms-2 mt-3" th:if="${!#lists.isEmpty(observaciones)}">
                                                    <li th:each="obs : ${observaciones}" class="timeline-item timeline-item-transparent pb-3">
                                                          <span class="timeline-point-wrapper">
                                                            <span class="timeline-point timeline-point-info"></span>
                                                          </span>
                                                        <div class="timeline-event">
                                                            <div class="d-flex justify-content-between flex-wrap mb-1">
                                                                <h6 class="mb-0 text-primary" th:text="${obs.usuario != null ? obs.usuario.nombres + ' ' + obs.usuario.apellidos : '—'}">Coordinador</h6>
                                                                <div class="text-end">
                                                                    <small class="text-muted d-block" th:text="${#temporals.format(obs.fecha, 'dd/MM/yyyy HH:mm')}">18/07/2025 14:32</small>
                                                                </div>
                                                            </div>
                                                            <p class="mb-2 text-dark" th:text="${obs.contenido}">Texto de la observación...</p>
                                                        </div>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- / Content -->
                <!-- Footer -->
                <!-- / Footer -->
                <div class="content-backdrop fade"></div>
            </div>
            <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
    </div>
    <!-- Overlay -->
    <div class="layout-overlay layout-menu-toggle"></div>
    <!-- Drag Target Area To SlideIn Menu On Small Screens -->
    <div class="drag-target"></div>
</div>
<!-- / Layout wrapper -->
<script th:src="@{/vendor/libs/jquery/jquery.js}"></script>
<script th:src="@{/vendor/libs/popper/popper.js}"></script>
<script th:src="@{/vendor/js/bootstrap.js}"></script>
<script th:src="@{/vendor/libs/perfect-scrollbar/perfect-scrollbar.js}"></script>
<script th:src="@{/vendor/libs/typeahead-js/typeahead.js}"></script>
<script th:src="@{/vendor/js/menu.js}"></script>
<!-- Vendors JS -->
<script th:src="@{/vendor/libs/swiper/swiper.js}"></script>
<script th:src="@{/vendor/libs/rateyo/rateyo.js}"></script>
<!-- Main JS -->
<script th:src="@{/js/main.js}"></script>
<!-- Page JS -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const swiper3D = document.querySelector("#swiper-3d-coverflow-effect");
        if (swiper3D) {
            new Swiper("#swiper-3d-coverflow-effect", {
                effect: "coverflow",
                grabCursor: true,
                centeredSlides: true,
                slidesPerView: "auto",
                initialSlide: 1,
                coverflowEffect: {
                    rotate: 50,
                    stretch: 0,
                    depth: 100,
                    modifier: 1,
                    slideShadows: true,
                },
                pagination: {
                    el: ".swiper-pagination",
                }
            });
        }
    });
</script>
<script>
    function volver() {
        if (document.referrer) {
            history.back();
        } else {
            window.location.href = '/administrador/espacios-deportivos';
        }
    }
</script>
<script th:src="@{/js/calificacion.js}"></script>
</body>
</html>