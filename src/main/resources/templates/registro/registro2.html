<!DOCTYPE html>
<html lang="es"
      class="light-style layout-wide customizer-hide"
      dir="ltr"
      data-theme="theme-semi-dark"
      data-assets-path="/"  data-template="vertical-menu-template-semi-dark"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />
    <title>Registro - Municipalidad de San Miguel</title>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <meta name="description" content="¬°Reg√≠strate en nuestra p√°gina web para realizar reservas deportivas en el distrito de San Miguel!." />
    <meta name="keywords" content="registro, san miguel, espacios deportivos, reservar" />

    <link rel="icon" type="image/x-icon" th:href="@{/img/icono.ico}" />
    <link rel="preconnect" href="https://fonts.googleapis.com/">
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&amp;display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/vendor/fonts/boxicons.css}" />
    <link rel="stylesheet" th:href="@{/vendor/fonts/fontawesome.css}" />
    <link rel="stylesheet" th:href="@{/vendor/fonts/flag-icons.css}" />
    <link rel="stylesheet" th:href="@{/vendor/css/rtl/core.css}" class="template-customizer-core-css" />
    <link rel="stylesheet" th:href="@{/vendor/css/rtl/theme-semi-dark.css}" class="template-customizer-theme-css" />
    <link rel="stylesheet" th:href="@{/css/demo.css}" />
    <link rel="stylesheet" th:href="@{/vendor/libs/perfect-scrollbar/perfect-scrollbar.css}" />
    <link rel="stylesheet" th:href="@{/vendor/libs/typeahead-js/typeahead.css}" />
    <link rel="stylesheet" th:href="@{/vendor/libs/form-validation/form-validation.css}" />
    <link rel="stylesheet" th:href="@{/vendor/css/pages/page-auth.css}">
    <script th:src="@{/vendor/js/helpers.js}"></script>
    <script th:src="@{/js/config.js}"></script>

    <style>
        .transition-layout {
            transition: all 0.4s ease;
        }
        .shake {
            animation: shake 0.3s ease;
        }
        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
        input[readonly] {
            user-select: none;
            pointer-events: none;
            background-color: #f8f9fa;
        }
        input[type="password"]::-ms-reveal,
        input[type="password"]::-ms-clear,
        input[type="password"]::-webkit-credentials-auto-fill-button,
        input[type="password"]::-webkit-textfield-decoration-container {
            display: none !important;
        }
        input[type="password"]::after {
            display: none !important;
        }
    </style>
</head>
<body>

<div class="authentication-wrapper authentication-cover">
    <div class="authentication-inner row m-0">
        <div id="registro-imagen" class="d-none d-lg-flex col-lg-7 col-xl-7 align-items-center p-0 transition-layout">
            <div class="w-100 h-100 d-flex justify-content-center align-items-center">
                <img src="/img/fondo-login.png" class="img-fluid" alt="Imagen de registro" style="height: 100%; object-fit: cover;">
            </div>
        </div>
        <div id="registro-formulario" class="d-flex col-12 col-lg-5 col-xl-5 align-items-center authentication-bg p-sm-5 p-4 transition-layout">
            <div id="registro-contenido" class="w-px-400 mx-auto">
                <div class="app-brand mb-5">
                    <a th:href="@{/}" class="app-brand-link gap-2"> <span class="app-brand-logo demo">
                        <img th:src="@{/img/icono.ico}" alt="Logo" style="height: 40px; width: 40px;"> </span>
                        <span class="app-brand-text demo text-body fw-bold">San Miguel</span>
                    </a>
                </div>
                <h4 class="mb-2">Reg√≠strate desde aqu√≠ üòÑ</h4>
                <p class="mb-3">Crea tu cuenta y comienza a utilizar nuestro sistema de reservas de espacios deportivos de la Municipalidad de San Miguel</p>

                <div th:if="${error}" class="alert alert-danger fade show" role="alert" id="mensaje-error">
                    <i class="bx bx-error-circle"></i>
                    <span th:text="${error}"></span>
                </div>

                <div id="aviso-consulta" class="alert alert-info py-2 px-3" role="alert" style="font-size: 0.95rem; text-align: justify;">
                    ‚ÑπÔ∏è Puedes hacer hasta <strong>10 consultas de DNI</strong> cada <strong>5 minutos</strong>.</div>

                <div id="bloqueo-msg" class="alert alert-warning d-none text-center py-2 px-3" role="alert" style="font-size: 0.95rem;">
                    ‚ö†Ô∏è Has superado el l√≠mite de intentos. Puedes volver a intentar en <span id="bloqueo-timer">5:00</span>
                </div>


                <!-- HTML (modificado de tu registro html) -->
                <form th:action="@{/registro}" method="post" id="formRegistro">
                    <!-- CSRF Token obligatorio -->
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

                    <!-- DNI visible solo en el paso 1 -->
                    <div id="dni-section">
                        <label for="dni">N√∫mero de DNI</label>
                        <input style="border-radius: 15px;" type="text" id="dni" name="dni" placeholder="Ingresa tu n√∫mero de DNI" class="form-control" maxlength="8" inputmode="numeric" pattern="\\d*" required>
                        <div id="dni-validation-msg" class="text-danger small d-none mt-1">El DNI debe tener exactamente 8 d√≠gitos.</div>
                        <div id="dni-error" class="text-danger small d-none mt-1"></div>

                        <div class="form-check mt-3">
                            <input class="form-check-input" type="checkbox" id="terms-conditions">
                            <label class="form-check-label" for="terms-conditions">
                                Acepto la <a href="#" data-bs-toggle="modal" data-bs-target="#politicaModal">pol√≠tica de privacidad y los t√©rminos</a>
                            </label>
                            <div id="terms-error" class="text-danger small d-none mt-1">Debes aceptar la pol√≠tica de privacidad</div>
                        </div>

                        <button type="button" style="border-radius: 15px;" id="btnContinuar" class="col-12 mb-2 btn btn-primary mt-3">Siguiente</button>
                    </div>

                    <!-- DNI oculto que se usar√° en el submit -->
                    <input type="hidden" name="dni" id="dni-hidden" />

                    <!-- Campos del paso 2 -->
                    <div id="form-fields" style="display:none;">
                        <div class="row mb-3">
                            <div class="col">
                                <label class="form-label" for="nombres">Nombres</label>
                                <input style="border-radius: 15px;" type="text" id="nombres" name="nombres" class="form-control" readonly oncopy="return false" onpaste="return false" oncut="return false" onselectstart="return false">
                            </div>
                            <div class="col">
                                <label class="form-label" for="apellidos">Apellidos</label>
                                <input style="border-radius: 15px;" type="text" id="apellidos" name="apellidos" class="form-control" readonly oncopy="return false" onpaste="return false" oncut="return false" onselectstart="return false">
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col">
                                <label class="form-label" for="correo">Correo</label>
                                <input style="border-radius: 15px;" type="email" id="correo" name="correo" class="form-control" placeholder="ejemplo@gmail.com" autocomplete="off">
                                <div id="correo-error" class="text-danger small d-none mt-1">Este correo ya est√° registrado.</div>
                            </div>
                            <div class="col">
                                <label class="form-label" for="telefono">Tel√©fono</label>
                                <input style="border-radius: 15px;" type="text" id="telefono" name="telefono" class="form-control" placeholder="999 999 999" inputmode="numeric" autocomplete="off">
                                <small id="telefono-error" class="text-danger d-none mt-1"></small>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col">
                                <label class="form-label" for="contrasena">Contrase√±a</label>
                                <div class="input-group input-group-merge">
                                    <input style="border-top-left-radius: 15px; border-bottom-left-radius: 15px;" type="password" id="contrasena" name="contrasena" class="form-control" required placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7" autocomplete="off">
                                    <span class="input-group-text cursor-pointer" style="border-top-right-radius: 15px; border-bottom-right-radius: 15px;"><i class="bx bx-hide"></i></span>
                                </div>
                                <small id="passwordHelp" class="form-text text-danger" style="display: none;">La contrase√±a no cumple los requisitos.</small>
                                <div class="progress mt-2" style="height: 8px;">
                                    <div id="passwordStrengthBar" class="progress-bar" role="progressbar" style="width: 0%; background-color: red;"></div>
                                </div>
                            </div>
                            <div class="col">
                                <label class="form-label" for="confirmContrasena">Confirmar contrase√±a</label>
                                <div class="input-group input-group-merge">
                                    <input style="border-top-left-radius: 15px; border-bottom-left-radius: 15px;" type="password" id="confirmContrasena" name="confirmContrasena" class="form-control" required placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7">
                                    <span class="input-group-text cursor-pointer" style="border-top-right-radius: 15px; border-bottom-right-radius: 15px;"><i class="bx bx-hide"></i></span>
                                </div>
                                <small id="confirmPasswordHelp" class="form-text text-danger" style="display: none;"></small>
                            </div>
                        </div>
                        <button type="submit" style="border-radius: 15px;" class="col-12 mt-3 mb-2 btn btn-success" id="btnRegistrarme">Registrarme</button>
                    </div>
                </form>

                <p class="text-center">
                    <span>¬øYa tiene una cuenta?</span>
                    <a th:href="@{/login}">
                        <span>Inicie sesi√≥n en su lugar</span>
                    </a>
                </p>
            </div>
        </div>
    </div>
</div>
<!-- Modal de Pol√≠tica de Privacidad y T√©rminos -->
<div class="modal fade" id="politicaModal" tabindex="-1" aria-labelledby="politicaModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="politicaModalLabel">Pol√≠tica de Privacidad y T√©rminos de Uso</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div th:replace="~{fragments/politica :: contenido}"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>

<script th:src="@{/vendor/libs/jquery/jquery.js}"></script>
<script th:src="@{/vendor/libs/popper/popper.js}"></script>
<script th:src="@{/vendor/js/bootstrap.js}"></script>
<script th:src="@{/vendor/libs/perfect-scrollbar/perfect-scrollbar.js}"></script>
<script th:src="@{/vendor/libs/hammer/hammer.js}"></script>
<script th:src="@{/vendor/libs/i18n/i18n.js}"></script>
<script th:src="@{/vendor/libs/typeahead-js/typeahead.js}"></script>
<script th:src="@{/vendor/js/menu.js}"></script>
<script th:src="@{/vendor/libs/form-validation/popular.js}"></script>
<script th:src="@{/vendor/libs/form-validation/bootstrap5.js}"></script>
<script th:src="@{/vendor/libs/form-validation/auto-focus.js}"></script>
<script th:src="@{/js/main.js}"></script>
<!-- JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script th:src="@{/js/registroNuevo.js}"></script>
<script>
    // Ocultar mensaje autom√°ticamente despu√©s de 4 segundos
    setTimeout(() => {
        const alert = document.getElementById("mensaje-error");
        if (alert) alert.classList.add("d-none");
    }, 4000);

    function setupTogglePassword() {
        document.querySelectorAll('.input-group-text.cursor-pointer').forEach(btn => {
            btn.addEventListener('click', () => {
                const input = btn.previousElementSibling;
                const icon = btn.querySelector('i');
                if (input.type === 'password') {
                    input.type = 'text';
                    icon.classList.replace('bx-hide', 'bx-show');
                } else {
                    input.type = 'password';
                    icon.classList.replace('bx-show', 'bx-hide');
                }
            });
        });
    }

</script>

</body>
</html>